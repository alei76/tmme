<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:task="http://www.springframework.org/schema/task"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
		http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.1.xsd">

    <context:component-scan base-package="org.tmme.ci.*.service" />
    
    <bean id="passwordEncoder" class="org.springframework.security.authentication.encoding.ShaPasswordEncoder" />
    
    <!-- Social -->
    
    <bean id="connectionFactoryLocator"
       class="org.springframework.social.connect.support.ConnectionFactoryRegistry">
       <property name="connectionFactories">
           <list>
               <bean
                   class="org.springframework.social.facebook.connect.FacebookConnectionFactory">
                   <constructor-arg value="${facebook.clientId}" />
                   <constructor-arg value="${facebook.clientSecret}" />
               </bean>
			<bean
                   class="org.springframework.social.twitter.connect.TwitterConnectionFactory">
                   <constructor-arg value="${twitter.consumerKey}" />
                   <constructor-arg value="${twitter.consumerSecret}" />
               </bean>
           </list>
       </property>
   </bean>	
	
   <bean id="textEncryptor" class="org.springframework.security.crypto.encrypt.Encryptors" factory-method="noOpText" />
   
   
    <!-- Recommender -->
    
    <bean id="recommenderDataModel" class="org.apache.mahout.cf.taste.impl.model.mongodb.MongoDBDataModel" >
    	<constructor-arg value="${mongodb.host}" />
    	<constructor-arg value="${mongodb.port}" />
    	<constructor-arg value="${mongodb.db}" />
    	<constructor-arg value="reviews" />
    	<constructor-arg value="true" />
    	<constructor-arg value="false" />
    	<constructor-arg>
    		<bean class="java.text.SimpleDateFormat">
    			<constructor-arg value="EE MMM dd yyyy HH:mm:ss 'GMT'Z (zzz)" />
    			<constructor-arg>
    				<util:constant static-field="java.util.Locale.ENGLISH" />
    			</constructor-arg>
    		</bean>
    	</constructor-arg>
    	<constructor-arg value="userId" />
    	<constructor-arg value="itemId" />
    	<constructor-arg value="rate" />
    	<constructor-arg value="mongo_data_model_map" />
    </bean> 
    
    <bean id="recommendedItemsConverter" class="org.tmme.ci.recommender.converter.RecommendedItemsConverter" />
    <bean id="idConverter" class="org.tmme.ci.recommender.converter.IdConverter" />
    
    <bean id="recommenderFactory" class="org.tmme.ci.recommender.cf.factory.impl.RecommenderFactoryImpl" />
    
    <bean id="recommender" factory-bean="recommenderFactory" factory-method="createRecommender">
    	<constructor-arg value="${cf.recommender.type}" />
    	<constructor-arg value="${cf.recommender.similarity}" />
    	<constructor-arg ref="recommenderDataModel" />
    </bean>

    <bean id="collaborativeFilteringRecommenderService" class="org.tmme.ci.recommender.service.impl.CollaborativeFilteringRecommenderService" />
    <bean id="contentBasedRecommenderService" class="org.tmme.ci.recommender.service.impl.ContentBasedRecommenderService" />
    
    <bean id="solrServer" class="org.apache.solr.client.solrj.impl.HttpSolrServer">
    	<constructor-arg value="${solr.url}" />
    </bean>

    <bean id="solrRestTemplate" class="org.springframework.web.client.RestTemplate" />
    
    <bean id="solrSearchService" class="org.tmme.ci.search.service.impl.SearchServiceImpl">
    	<constructor-arg value="${solr.url}/update/json?commit=true" />
    	<constructor-arg>
    		<set>
    			<value>_version_</value>
    		</set>
    	</constructor-arg>
    </bean>
    
    <bean id="solrIndexer" class="org.tmme.ci.search.populator.SolrIndexer" >
    	<constructor-arg value="${solr.update.index.oneshot}" />
    </bean>
    
    <task:scheduler id="solrIndexerScheduler" pool-size="1" />
    <task:scheduled-tasks scheduler="solrIndexerScheduler">
    	<task:scheduled ref="solrIndexer" method="updateIndex" cron="${solr.update.index.cron}" />
    </task:scheduled-tasks>
    
    

</beans>